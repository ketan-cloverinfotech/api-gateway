name: Tag Rollback Workflow
on:
  workflow_dispatch:
    inputs:
      rollback_choice:
        description: 'Do you want to rollback?'
        required: true
        type: choice
        options:
          - 'No'
          - 'Yes'
      target_tag:
        description: 'MANUALLY ENTER TAG (see available tags below)'
        required: false
        type: string
        default: 'v1'

jobs:
  list_tags:
    if: inputs.rollback_choice == 'Yes'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Show available tags
        run: |
          echo "AVAILABLE TAGS IN REPOSITORY:"
          git tag --sort=-creatordate
          echo "----------------------------"
          echo "Please copy EXACTLY one tag"
          echo "and paste it in the target_tag field"

  perform_rollback:
    needs: list_tags
    if: inputs.rollback_choice == 'Yes' && inputs.target_tag != ''
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Verify tag exists
        run: |
          if ! git show-ref --tags "${{ inputs.target_tag }}"; then
            echo "::error::Tag ${{ inputs.target_tag }} does not exist!"
            exit 1
          fi

      - name: Confirm selection
        run: |
          echo "SUCCESS: You selected tag '${{ inputs.target_tag }}'"
          echo "Ready to execute: git checkout ${{ inputs.target_tag }}"
          echo "Add your rollback commands below this step"
